<!DOCTYPE html>
<html>

<head>
    <title>Test (New Storage)</title>
</head>

<body>
    <div id='output'></div>
    <div style="margin-top: 50px;"></div>
    <button id="btnFade">Stop Fading</button>
    <div id="result" style="margin-top: 10px;">fade me</div>
    <div style="margin-top: 40px;"></div>
    <button id="access" style="display: none;">Get Access</button>
</body>

</html>

<style>
    .hide {
        opacity: 0;
        transition: opacity 2000ms;
    }

    .show {
        opacity: 1;
        transition: opacity 2000ms;
    }
</style>

<script>
    (function () {
        // your page initialization code here
        // the DOM will be available here
        // Opera 8.0+
        var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;

        // Firefox 1.0+
        var isFirefox = typeof InstallTrigger !== 'undefined';

        // Safari 3.0+ "[object HTMLElementConstructor]" 
        var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] || (typeof safari !== 'undefined' && safari.pushNotification));

        // Edge 20+
        var isEdge = !!window.StyleMedia;

        // Chrome 1 - 79
        var isChrome = !!window.chrome && (!!window.chrome.webstore || !!window.chrome.runtime);

        // Edge (based on chromium) detection
        var isEdgeChromium = isChrome && (navigator.userAgent.indexOf("Edg") != -1);
        // Blink engine detection

        var isBlink = (isChrome || isOpera) && !!window.CSS;
        var output = 'Detecting browsers by ducktyping:<hr>';
        output += 'isFirefox: ' + isFirefox + '<br>';
        output += 'isChrome: ' + isChrome + '<br>';
        output += 'isSafari: ' + isSafari + '<br>';
        output += 'isOpera: ' + isOpera + '<br>';
        output += 'isEdge: ' + isEdge + '<br>';
        output += 'isEdgeChromium: ' + isEdgeChromium + '<br>';
        output += 'isBlink: ' + isBlink + '<br>';
        document.getElementById('output').innerHTML = output;

        //FADE
        var runningFade = true;

        function fadeIn(el) {
            el.classList.add('show');
            el.classList.remove('hide');
        }

        function fadeOut(el) {
            el.classList.add('hide');
            el.classList.remove('show');
        }

        var btn = document.getElementById('btnFade');
        var img = document.getElementById('result');

        btn.addEventListener('click', function () {
            runningFade = !runningFade;
        });


        function start() {
            setTimeout(fadeToggle, 0)
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function fadeToggle() {
            while (runningFade) {
                if (img.className.indexOf('hide') !== -1) {
                    fadeIn(img);
                    this.innerHTML = 'Fade Out';
                }
                else {
                    fadeOut(img);
                    this.innerHTML = 'Fade In';
                }
                await sleep(2000);
            }
        }
        start();

        //TEST
        console.log('test');

        document.getElementById('access').onclick = function () {
            var promise = document.requestStorageAccess();
            promise.then(
                function () {
                    console.log('access was granted');
                },
                function () {
                    console.log('access was denied');
                }
            );
        };

        var sourceinId = 'id-ville';


        if (isChrome) {

        }
        else {
            var promise = document.hasStorageAccess();
            promise.then(
                function (hasAccess) {
                    console.log('has access');
                    console.log(hasAccess);
                },
                function (reason) {
                    console.log('no access');
                    console.log(reason);
                    document.getElementById('access').style.display = 'inherit';
                }
            );
        }
    })();
</script>